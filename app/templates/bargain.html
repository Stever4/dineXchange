{% include 'header.html' %}
<script type = 'text/javascript'>
window.onload = getOffer();
var otherSent = false;
var agreed = false;

function sendOffer(){
    console.log("Hello");
    var money = document.getElementById('offer').value;
    if(!isNaN(money)){
        var room = window.location;
        room = room.search; 
        room = room.substring(6);
        var myRootRef = new Firebase('https://dxc.firebaseio.com/bargains/'+room);
        myRootRef.child('offer').set(money);
        document.getElementById('agreeButton').innerHTML = "Waiting for agreement...";
        otherSent = false;
    }
    document.getElementById('offer').value = "";

}

function getOffer(){
    var room = window.location;
    room = room.search; 
    room = room.substring(6);
    var otherRootRef = new Firebase('https://dxc.firebaseio.com/bargains/'+room);
    otherRootRef.on('value', function(snapshot){
            if(snapshot.val() != null){
                if(snapshot.val()['offer'] != null)
                {
                    var money = snapshot.val()['offer'];
                    console.log("Initial offer"+money);
                    document.getElementById('otherOffer').innerHTML = "Other offer:"+money;
                    document.getElementById("agreeButton").innerHTML = "Agree";
                    otherSent = true;
                }
                else{
                    if(snapshot.val()['agreed']){
                        console.log("Testing");
                        window.location = '/chat?room='+room;
                    }
                }

        }
    })
}

function agree(){
    var room = window.location;
    room = room.search; 
    room = room.substring(6);
    var agreementRef = new Firebase('https://dxc.firebaseio.com/bargains/'+room)
    if(otherSent){
        agreed = true;
        console.log("Test");
        window.location = '/chat?room='+room;
    }
    agreementRef.child('agreed').set(agreed);

}

</script>

<div style="text-align: center;">


    <div>
        <label>My Offer:</label>
        <input type="text" id="offer"/>
        <a class = "btn btn-lg btn-primary" onclick="return sendOffer()">Send offer</a>
    </div>
    <label id="otherOffer">Other offer:</label>
    <a class = "btn btn-lg btn-primary" onclick="return agree()" id = "agreeButton">Waiting for agreement...</a>
</div>
{% include 'footer.html' %}